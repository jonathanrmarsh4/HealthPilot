import{W as f,K as d,C as m,a as l,S as o,b as y}from"./index-khXkX6AG.js";function x(a){return a!==void 0&&Object.keys(y).includes(a)}class r extends f{constructor(){super(...arguments),this.prefix="capacitor-storage_",this.sync=!1,this.access=d.whenUnlocked}async setSynchronize(e){if(this.sync=e,m.getPlatform()==="ios")return this.setSynchronizeKeychain({sync:e})}async getSynchronize(){return this.sync}async setDefaultKeychainAccess(e){this.access=e}async tryOperation(e){try{return await e()}catch(t){throw t instanceof l&&x(t.code)?new o(t.message,t.code):t}}async get(e,t=!0,s){if(e){const{data:i}=await this.tryOperation(async()=>this.internalGetItem({prefixedKey:this.prefixedKey(e),sync:s??this.sync}));if(i===null)return null;if(t){const n=g(i);if(n)return n}try{return JSON.parse(i)}catch{throw new o("Invalid data",y.invalidData)}}return r.missingKey()}async getItem(e){if(e){const{data:t}=await this.tryOperation(async()=>this.internalGetItem({prefixedKey:this.prefixedKey(e),sync:this.sync}));return t}return null}async set(e,t,s=!0,i,n){if(e){let c=t;return s&&t instanceof Date&&(c=t.toISOString()),this.tryOperation(async()=>this.internalSetItem({prefixedKey:this.prefixedKey(e),data:JSON.stringify(c),sync:i??this.sync,access:n??this.access}))}return r.missingKey()}async setItem(e,t){return e?this.tryOperation(async()=>this.internalSetItem({prefixedKey:this.prefixedKey(e),data:t,sync:this.sync,access:this.access})):r.missingKey()}async remove(e,t){if(e){const{success:s}=await this.tryOperation(async()=>this.internalRemoveItem({prefixedKey:this.prefixedKey(e),sync:t??this.sync}));return s}return r.missingKey()}async removeItem(e){if(e){await this.tryOperation(async()=>this.internalRemoveItem({prefixedKey:this.prefixedKey(e),sync:this.sync}));return}r.missingKey()}async keys(e){const{keys:t}=await this.tryOperation(async()=>this.getPrefixedKeys({prefix:this.prefix,sync:e??this.sync})),s=this.prefix.length;return t.map(i=>i.slice(s))}async getKeyPrefix(){return this.prefix}async setKeyPrefix(e){this.prefix=e}prefixedKey(e){return this.prefix+e}static missingKey(){throw new o("No key provided",y.missingKey)}}const K=/^"(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}).(\d{3})Z"$/u;function g(a){const e=K.exec(a);if(e){const t=Number.parseInt(e[1],10),s=Number.parseInt(e[2],10)-1,i=Number.parseInt(e[3],10),n=Number.parseInt(e[4],10),c=Number.parseInt(e[5],10),h=Number.parseInt(e[6],10),p=Number.parseInt(e[7],10),u=Date.UTC(t,s,i,n,c,h,p);return new Date(u)}return null}export{r as S};
