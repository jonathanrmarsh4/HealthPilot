
Build a Sleep Dashboard for an AI Health App

Design and develop a Sleep Dashboard page for a mobile health app that integrates with Apple HealthKit to track and visualize sleep metrics. The dashboard should provide users with an intuitive, visually appealing interface to monitor and understand their sleep patterns.

**Data Source**
- Pull sleep data from Apple HealthKit, including sleep duration, sleep stages (Awake, Light, Deep, REM), bedtime, wake time, and any available sleep quality metrics.
- Ensure compatibility with Apple HealthKit’s sleep analysis data structure and handle cases where data is incomplete or unavailable (e.g., user didn’t wear device, data not synced).

**Features**
1. **Sleep Score**:
   - Display a daily sleep score (0-100) based on sleep duration, quality, and consistency, calculated using a simple algorithm (e.g., weighted combination of total sleep time, time in Deep/REM stages, and adherence to a consistent bedtime).
   - Show a brief explanation of the score (e.g., “Your score of 85 reflects 7.5 hours of sleep with good Deep sleep but slight bedtime inconsistency”).
   - Include a color-coded indicator (e.g., green for 80-100, yellow for 60-79, red for <60) for quick visual feedback.

2. **Previous Night’s Sleep Stages Chart**:
   - Create a timeline or stacked bar chart showing the previous night’s sleep stages (Awake, Light, Deep, REM) with time spent in each stage.
   - Include bedtime and wake time labels, total sleep duration, and a breakdown of time spent in each stage (e.g., “Deep: 1h 20m, 18%”).
   - Allow users to tap on a stage for a brief description (e.g., “Deep sleep supports physical recovery”).
   - Handle cases where sleep stage data is missing by displaying total sleep duration only and a note about limited data.

3. **Sleep Quality Trend Graph**:
   - Display a line or bar graph showing sleep quality (e.g., sleep score or total sleep duration) over a user-selectable time period (e.g., past 7 days, 30 days, or 90 days).
   - Include a trend line or average to highlight improvements or declines in sleep quality.
   - Add annotations for outliers (e.g., “Poor sleep on Oct 3 due to short duration”) and allow users to toggle between metrics (e.g., sleep score, total sleep time, time in Deep/REM).

**Additional Requirements**
- **User Experience**:
  - Design a clean, mobile-friendly UI with dark mode support for nighttime viewing.
  - Include a loading state and error handling for when HealthKit data is unavailable (e.g., “Please enable HealthKit permissions” or “No sleep data for this period”).
  - Provide tooltips or a help section explaining sleep stages and the sleep score algorithm.
- **Personalization**:
  - Allow users to set a target sleep duration (e.g., 8 hours) and display progress toward this goal.
  - Offer insights or tips based on trends (e.g., “Consistent bedtimes may improve your sleep score”).
- **Performance**:
  - Optimize data queries to minimize battery usage and ensure fast load times.
  - Cache recent data to support offline viewing.
- **Privacy**:
  - Ensure compliance with Apple HealthKit privacy guidelines and clearly communicate data usage to users.

- Add a comparison feature to show how the user’s sleep metrics compare to general population averages (e.g., “Your Deep sleep is above average for your age group”).
- Include a bedtime reminder notification based on the user’s typical sleep schedule.
- Allow export of sleep data as a PDF or CSV for sharing with healthcare providers.
